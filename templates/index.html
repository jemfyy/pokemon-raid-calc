<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>PokÃ©mon GO ë ˆì´ë“œ ì¶”ì²œ</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 2rem; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background-color: #f5f5f5; }
    label { display: block; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>ğŸ” ë ˆì´ë“œ ì¶”ì²œ í¬ì¼“ëª¬ ê³„ì‚°ê¸°</h1>

  <!-- ë³´ìŠ¤ ì„ íƒ -->
  <label for="bossSelect">ë³´ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
  <select id="bossSelect" onchange="loadBossInfo()"></select>

  <!-- ë³´ìŠ¤ ê¸°ìˆ  ì„ íƒ -->
  <label for="fastMoveSelect">ë¹ ë¥¸ ê¸°ìˆ  ì„ íƒ:</label>
  <select id="fastMoveSelect"></select>

  <label for="chargedMoveSelect">ì°¨ì§€ ê¸°ìˆ  ì„ íƒ:</label>
  <select id="chargedMoveSelect"></select>

  <button onclick="fetchData()">ì¶”ì²œ ë³´ê¸°</button>

  <!-- ê²°ê³¼ í…Œì´ë¸” -->
  <table id="resultTable" style="display:none;">
    <thead>
      <tr>
        <th>ì´ë¦„</th><th>íƒ€ì…</th><th>ê¸°ìˆ </th><th>DPS</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // ë³´ìŠ¤ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadBosses() {
      const res = await fetch('/bosses');
      const bosses = await res.json();
      const select = document.getElementById("bossSelect");

      bosses.forEach(boss => {
        const option = document.createElement("option");
        option.value = boss;
        option.textContent = boss;
        select.appendChild(option);
      });

      // ê¸°ë³¸ ì„ íƒëœ ë³´ìŠ¤ ì •ë³´ ë¡œë”©
      if (bosses.length > 0) {
        loadBossInfo();
      }
    }

    // ë³´ìŠ¤ ì •ë³´ ë¶ˆëŸ¬ì™€ ê¸°ìˆ  ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
    async function loadBossInfo() {
      const boss = document.getElementById("bossSelect").value;
      const res = await fetch(`/boss_info?boss=${boss}`);
      const data = await res.json();

      const fastSelect = document.getElementById("fastMoveSelect");
      const chargedSelect = document.getElementById("chargedMoveSelect");

      fastSelect.innerHTML = "";
      chargedSelect.innerHTML = "";

      data.moves.fast.forEach(move => {
        const opt = document.createElement("option");
        opt.value = move;
        opt.textContent = move;
        fastSelect.appendChild(opt);
      });

      data.moves.charged.forEach(move => {
        const opt = document.createElement("option");
        opt.value = move;
        opt.textContent = move;
        chargedSelect.appendChild(opt);
      });
    }

    // ì¶”ì²œ í¬ì¼“ëª¬ ë¶ˆëŸ¬ì˜¤ê¸°
    async function fetchData() {
      const boss = document.getElementById("bossSelect").value;
      const fast = document.getElementById("fastMoveSelect").value;
      const charged = document.getElementById("chargedMoveSelect").value;

      const res = await fetch(`/counters?boss=${boss}&fast=${encodeURIComponent(fast)}&charged=${encodeURIComponent(charged)}`);
      const data = await res.json();

      const table = document.getElementById("resultTable");
      const tbody = table.querySelector("tbody");
      tbody.innerHTML = "";
      table.style.display = "table";

      data.forEach(p => {
        const row = `<tr>
          <td>${p.name}</td>
          <td>${p.types.join(", ")}</td>
          <td>${p.moves.join(", ")}</td>
          <td>${p.dps}</td>
        </tr>`;
        tbody.insertAdjacentHTML("beforeend", row);
      });
    }

    window.onload = loadBosses;
  </script>
</body>
</html>
